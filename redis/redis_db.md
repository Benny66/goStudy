持久化
灾难恢复，数据恢复

redis如何做持久化?
RDB:内存快照
AOF：记录操作日志

RDB就是将每隔一段时间存储在内存的数据快照到二进制文件中，dump.rdb
- 优点：使用快照，恢复数据快
- 缺点：数据不全
- 工作流程
- - redis根据配置自己尝试去生成rdb快照文件
- - fork一个子进程出来
- - 子进程尝试将数据dump到临时的rdb快照文件中
- - 完成rdb快照文件的生成之后，就替换之前的旧的快照文件
- 产生快照的情况有以下几种
- - 手动bgsave执行，非阻塞
- - 手动save执行，阻塞
- - 根据配置文件自动执行(bgsave方式)
- - 客户端发送shutdown，系统会先执行save命令阻塞客户端，然后关闭服务器
- - 当有主从架构时，从服务器向主服务器发送sync命令来执行复制操作时，主服务器会执行bgsaxe操作
AOF就是将所有写入日志保存起来，恢复数据时重新跑日志恢复数据，appendonly.aof
优点：数据全
缺点：恢复数据慢，执行效率低


redisObject
- type,数据类型
- encoding，内部编码类型
- lru，最近一次访问的时间
- refcount，引用计数
- *ptr，对象的数据内容相关

redis优化：
- 缩减键值对象：缩短key和value的长度（例：对象序列化成二进制数存入redis）
- 共享对象池：同一个整数数值共用一个键值key

雪崩
大量缓存同时失效，访问压力落到数据库中。
事前：随机过期时间；主从redis缓存
事中：请求降级
事后：数据备份与恢复

